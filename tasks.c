/*************************************************************************************************
												zip51 
 										 51芯片上的实时内核
										 与任务管理有关的函数
										 作者：孤独剑
														2011年4月13日  修改
文件名：			zip51_task.c
包含函数个数：		4
需要用户修改函数个数：
					5个分别是 TaskIdle（），Task0（），Task1（），Task2（），Task3（）
*************************************************************************************************/

#ifndef  ZIP51_FILE
#include "includes.h"
#endif



/*********************************************************************************************************
函数名		：	OSIntInit
描述		：	初始化整个系统的中断
参数 		：	无
返回值		：	无
*********************************************************************************************************/
void			OSIntInit() small
{
		TMOD						= 0x10;
		TH1							= TH;
		TL1							= TL;
		EA							= 0;				///中断必须在多任务环境启动以后才可以启用
		ET1							= 1;
		TR1							= 1;	
}



/*********************************************************************************************************
函数名		：	TaskIdle
描述		：	每当系统CPU空闲时都会来到这里！
参数 		：	无
返回值		：	无
注意		：	在这里用户可以设置CPU工作于特殊的状态  这样可以节约一些功耗
				也可以将某一个led闪烁通过观察led亮度（或测试占空比）确定当前cpu使用率
*********************************************************************************************************/
void			TaskIdle (void ) small
{
	while ( 1 )
	{
		#if			IDLE_CNT_EN
		ENTER_CRITICAL();
		IdleCnt ++;
		EXIT_CRITICAL();
		#endif
		/*********************************
		在这里修改空闲模式下的行为
		*********************************/		
	}
}

/*********************************************************************************************************
函数名		：	Task0
描述		：	zip51的最高优先级任务
参数 		：	无
返回值		：	无
注意		：	注意每一个任务的格式是：
void		Task (void )
{
		///本任务初始化代码
		while (1 )
		{
				//需要处理的程序
		}
}
跟平时的main函数写法差不多但是注意  一定不要让这个函数返回。
*********************************************************************************************************/
void			Task0 (void)  small
{
	while (1){	
		Sleep(10);
	}
}

/*********************************************************************************************************
函数名		：	Task1
描述		：	zip51的优先级第二任务
参数 		：	无
返回值		：	无
注意		：	同上
*********************************************************************************************************/
void			Task1 (void)  small
{
	Sleep(50);
	while (1)
	{
	    Sleep (500);
	}
}



/*********************************************************************************************************
函数名		：	Task2
描述		：	zip51的优先级第三任务
参数 		：	无
返回值		：	无
注意		：	同上
*********************************************************************************************************/
void			Task2 (void)  small
{
	while (1)
	{
		Sleep(20);
	}
}

/*********************************************************************************************************
函数名		：	Task3
描述		：	zip51的优先级第四的任务
参数 		：	无
返回值		：	无
注意		：	同上
*********************************************************************************************************/	  
void			Task3 (void)  small
{
	while (1)
	{
		Sleep(10);
	}					            
}






